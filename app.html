<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>BM Pro - داشبورد</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #1f1c2c, #928dab);
      font-family: 'Vazirmatn', sans-serif;
      color: white;
    }
    header {
      padding: 15px;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .points {
      font-weight: bold;
      font-size: 1.2rem;
    }
    main {
      padding: 20px;
    }
    .panel {
      background: rgba(0,0,0,0.5);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
    }
    button {
      background: #5865F2;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      transform: scale(1.05);
      background: #4752c4;
    }
  </style>
</head>
<body>
  <header>
    <h2>BM Pro - داشبورد</h2>
    <div class="points">امتیاز: <span id="points">0</span></div>
  </header>

  <main>
    <div class="panel">
      <h3>اطلاعات کاربر</h3>
      <p>نام: <span id="username">در حال بارگذاری...</span></p>
      <p>Discord ID: <span id="userid">...</span></p>
    </div>

    <div class="panel">
      <h3>تسک‌ها</h3>
      <ul>
        <li><button onclick="completeTask('daily')">چک کردن روزانه سایت</button></li>
        <li><button onclick="completeTask('join')">ورود به چنل دیسکورد</button></li>
        <li><button onclick="completeTask('mobile')">ثبت شماره موبایل</button></li>
      </ul>
    </div>

    <div class="panel">
      <h3>چنل ما</h3>
      <a href="https://discord.gg/kkdDtDcG" target="_blank">
        <button>ورود به چنل</button>
      </a>
    </div>
  </main>

  <script>
    const REDIRECT_URI = "https://madsmart13.github.io/BM_pro/app.html";

    // گرفتن توکن از URL
    const fragment = new URLSearchParams(window.location.hash.slice(1));
    const accessToken = fragment.get("access_token");

    if (accessToken) {
      fetch("https://discord.com/api/users/@me", {
        headers: { Authorization: `Bearer ${accessToken}` }
      })
        .then(res => res.json())
        .then(user => {
          document.getElementById("username").textContent = user.username + "#" + user.discriminator;
          document.getElementById("userid").textContent = user.id;
          localStorage.setItem("discord_user", JSON.stringify(user));
        });
    } else {
      const savedUser = localStorage.getItem("discord_user");
      if (savedUser) {
        const user = JSON.parse(savedUser);
        document.getElementById("username").textContent = user.username + "#" + user.discriminator;
        document.getElementById("userid").textContent = user.id;
      }
    }

    // مدیریت امتیازها
    let points = parseInt(localStorage.getItem("bmpro_points")) || 0;
    document.getElementById("points").textContent = points;

    function completeTask(task) {
      if (!localStorage.getItem(`bmpro_task_${task}`)) {
        points += 10;
        localStorage.setItem("bmpro_points", points);
        localStorage.setItem(`bmpro_task_${task}`, true);
        document.getElementById("points").textContent = points;
        alert("تبریک! ۱۰ امتیاز گرفتید 🎉");
      } else {
        alert("این تسک رو قبلاً انجام دادید!");
      }
    }
  </script>
</body>
</html>
