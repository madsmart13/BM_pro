<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>BM Pro - داشبورد</title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #1f1c2c, #928dab);
    font-family: 'Vazirmatn', sans-serif;
    color: white;
  }
  header {
    padding: 15px;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .points {
    font-weight: bold;
    font-size: 1.2rem;
  }
  main {
    padding: 20px;
  }
  .panel {
    background: rgba(0,0,0,0.5);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
  }
  button.toggle-btn {
    background: #5865F2;
    color: white;
    border: none;
    padding: 10px 20px;
    font-size: 1rem;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
    margin-bottom: 10px;
  }
  button.toggle-btn:hover {
    transform: scale(1.05);
    background: #4752c4;
  }
  .hidden {
    display: none;
  }
  input[type="text"] {
    padding: 8px;
    border-radius: 6px;
    border: none;
    width: 200px;
    margin-right: 10px;
  }
  .shop-item {
    margin-bottom: 10px;
  }
</style>
</head>
<body>
<header>
  <h2>BM Pro - داشبورد</h2>
  <div class="points">امتیاز: <span id="points">0</span></div>
</header>
<main>

<!-- اطلاعات کاربر -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('info')">نمایش اطلاعات کاربر</button>
  <div id="info" class="hidden">
    <p>نام: <span id="username">در حال بارگذاری...</span></p>
    <p>Discord ID: <span id="userid">...</span></p>
  </div>
</div>

<!-- تسک ها -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('tasks')">تسک‌ها</button>
  <div id="tasks" class="hidden">
    <button onclick="completeTask('daily')">چک کردن روزانه سایت</button>
    <button onclick="joinDiscordChannel()">ورود به چنل دیسکورد</button>
    <button onclick="showMobileInput()">ثبت شماره موبایل</button>
    <div id="mobileInput" class="hidden">
      <input type="text" id="mobile" placeholder="شماره موبایل خود را وارد کنید">
      <button onclick="submitMobile()">ثبت</button>
      <p id="mobileMsg"></p>
    </div>
  </div>
</div>

<!-- فروشگاه -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('shop')">فروشگاه</button>
  <div id="shop" class="hidden">
    <div class="shop-item"><button onclick="buyItem('boost', 2000)">بوست دیسکورد 1 ماهه (2000 امتیاز)</button></div>
    <div class="shop-item"><button onclick="buyItem('premium', 1400)">اشتراک پرمیوم سرورها (1400 امتیاز)</button></div>
    <div class="shop-item"><button onclick="buyItem('vip', 1200)">وی ای پی + (1200 امتیاز)</button></div>
    <div class="shop-item"><button onclick="buyItem('silver', 900)">اشتراک نقره ای (900 امتیاز)</button></div>
    <div class="shop-item"><button onclick="buyItem('bronze', 590)">اشتراک برنز (590 امتیاز)</button></div>
    <div class="shop-item"><button onclick="buyItem('minecraft', 30000)">خرید سرور ماینکرافت (30000 امتیاز)</button></div>
    <p id="shopMsg"></p>
  </div>
</div>

<!-- سرورها -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('servers')">سرورها</button>
  <div id="servers" class="hidden">
    <button onclick="server1()">سرور 1</button>
    <button onclick="server2()">سرور 2</button>
    <button onclick="server3()">سرور 3</button>
    <button onclick="server4()">سرور 4</button>
    <div id="serverMsg"></div>
    <div id="passwordSection" class="hidden">
      <input type="text" id="serverPassword" placeholder="پسورد را وارد کنید">
      <button onclick="checkPassword()">تایید</button>
      <button onclick="closePassword()">بستن</button>
      <p id="passwordMsg"></p>
    </div>
  </div>
</div>

<script>
const DISCORD_CLIENT_ID = "1413174935593156718";
const REDIRECT_URI = "https://madsmart13.github.io/BM_pro/app.html";

function toggleSection(id) {
  const el = document.getElementById(id);
  el.classList.toggle('hidden');
}

// گرفتن توکن و اطلاعات کاربر
const fragment = new URLSearchParams(window.location.hash.slice(1));
const accessToken = fragment.get("access_token");
if (accessToken) {
  fetch("https://discord.com/api/users/@me", {
    headers: { Authorization: `Bearer ${accessToken}` }
  })
  .then(res => res.json())
  .then(user => {
    document.getElementById("username").textContent = user.username + "#" + user.discriminator;
    document.getElementById("userid").textContent = user.id;
    localStorage.setItem("discord_user", JSON.stringify(user));
  });
} else {
  const savedUser = localStorage.getItem("discord_user");
  if (savedUser) {
    const user = JSON.parse(savedUser);
    document.getElementById("username").textContent = user.username + "#" + user.discriminator;
    document.getElementById("userid").textContent = user.id;
  }
}

// امتیاز
let points = parseInt(localStorage.getItem("bmpro_points")) || 0;
document.getElementById("points").textContent = points;

function completeTask(task) {
  if (!localStorage.getItem(`bmpro_task_${task}`)) {
    points += 10;
    localStorage.setItem("bmpro_points", points);
    localStorage.setItem(`bmpro_task_${task}`, true);
    document.getElementById("points").textContent = points;
    alert("تبریک! ۱۰ امتیاز گرفتید 🎉");
  } else {
    alert("این تسک رو قبلاً انجام دادید!");
  }
}

// ورود به چنل دیسکورد
function joinDiscordChannel() {
  window.open("https://discord.com/invite/kkdDtDcG", "_blank");
  completeTask('join');
}

// شماره موبایل
function showMobileInput() {
  document.getElementById("mobileInput").classList.remove("hidden");
}
function submitMobile() {
  const mobile = document.getElementById("mobile").value.trim();
  const msg = document.getElementById("mobileMsg");
  if (!/^09\d{9}$/.test(mobile)) {
    msg.textContent = "شماره نامعتبر است!";
    return;
  }
  msg.textContent = "در انتظار تایید ادمین";
  if (!localStorage.getItem('bmpro_task_mobile')) {
    points += 10;
    localStorage.setItem("bmpro_points", points);
    localStorage.setItem('bmpro_task_mobile', true);
    document.getElementById("points").textContent = points;
  }
}

// فروشگاه
function buyItem(id, cost) {
  const msg = document.getElementById("shopMsg");
  if (points < cost) {
    msg.textContent = "امتیاز کافی نیست!";
    return;
  }
  points -= cost;
  localStorage.setItem("bmpro_points", points);
  document.getElementById("points").textContent = points;
  msg.textContent = "در سرور دیسکورد ما در بخش خرید پیام بگذارید";
}

// سرورها
function server1() { document.getElementById("serverMsg").textContent = "ورود دستی! ای پی سرور: wii1-rFFa.aternos.me:22481"; }
function server2() { document.getElementById("serverMsg").textContent = "سرور افلاین است"; }
function server3() {
  const el = document.getElementById("serverMsg");
  el.textContent = "در حال اتصال...";
  setTimeout(() => { el.textContent = "ورود خودکار ممکن نیست"; }, 5000);
}
function server4() {
  const el = document.getElementById("serverMsg");
  el.textContent = "در حال اتصال...";
  setTimeout(() => {
    el.textContent = "";
    document.getElementById("passwordSection").classList.remove("hidden");
  }, 4000);
}
function checkPassword() {
  const pass = document.getElementById("serverPassword").value;
  const msg = document.getElementById("passwordMsg");
  if (pass === "ijff[hihfhofh") {
    msg.textContent = "wii1-rFFa.aternos.me:22481";
  } else {
    msg.textContent = "پسورد اشتباه است";
  }
}
function closePassword() {
  document.getElementById("passwordSection").classList.add("hidden");
}
</script>
</body>
</html>
