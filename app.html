<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>BM Pro </title>
<style>
  body {
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #1f1c2c, #928dab);
    font-family: 'Vazirmatn', sans-serif;
    color: white;
  }
  header {
    padding: 15px;
    background: rgba(0,0,0,0.6);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .points {
    font-weight: bold;
    font-size: 1.2rem;
  }
  main { padding: 20px; }
  .panel { background: rgba(0,0,0,0.5); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
  button.toggle-btn, button { 
    background: linear-gradient(135deg,#5865F2,#4752c4); 
    color: white; 
    border: none; 
    padding: 12px 20px; 
    font-size: 1rem; 
    border-radius: 12px; 
    cursor: pointer; 
    transition: 0.3s; 
    margin: 5px 0;
  }
  button.toggle-btn:hover, button:hover { transform: scale(1.05); box-shadow: 0 0 10px #fff; }
  .hidden { display: none; }
  input[type="text"] { padding: 8px; border-radius: 6px; border: none; width: 220px; margin-right: 10px; }
  .shop-item { margin-bottom: 15px; display: flex; align-items: center; }
  .shop-item img { width: 50px; height: 50px; margin-left: 10px; border-radius: 8px; }
  .server-gif { width: 60px; height: 60px; margin-left: 10px; vertical-align: middle; }
</style>
</head>
<body>

<header>
  <h2>BM Pro - داشبورد</h2>
  <div class="points">امتیاز: <span id="points">0</span></div>
</header>

<main>

<!-- اطلاعات کاربر -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('info')">نمایش اطلاعات کاربر</button>
  <div id="info" class="hidden">
    <p>نام: <span id="username">در حال بارگذاری...</span></p>
    <p>Discord ID: <span id="userid">...</span></p>
  </div>
</div>

<!-- تسک ها -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('tasks')">تسک‌ها</button>
  <div id="tasks" class="hidden">
    <button onclick="completeTask('daily')">چک کردن روزانه سایت</button>
    <button onclick="joinDiscordChannel()">ورود به چنل دیسکورد</button>
    <button onclick="showMobileInput()">ثبت شماره موبایل</button>
    <div id="mobileInput" class="hidden">
      <input type="text" id="mobile" placeholder="شماره موبایل خود را وارد کنید">
      <button onclick="submitMobile()">ثبت</button>
      <p id="mobileMsg"></p>
    </div>
  </div>
</div>

<!-- فروشگاه -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('shop')">فروشگاه</button>
  <div id="shop" class="hidden">
    <div class="shop-item"><img src="https://images.g2a.com/uiadminimages/170x226/1x1x0/discord-nitro-1-mois/f8ad240ec4b64dddbc8c9cc3"><button onclick="buyItem('boost', 2000)">بوست دیسکورد 1 ماهه (2000 امتیاز)</button></div>
    <div class="shop-item"><img src="https://img.freepik.com/premium-vector/premium-icon-vector-illustration-design_535345-6533.jpg"><button onclick="buyItem('premium', 1400)">اشتراک پرمیوم سرورها (1400 امتیاز)</button></div>
    <div class="shop-item"><img src="https://cdn-icons-png.flaticon.com/512/6701/6701712.png"><button onclick="buyItem('vip', 1200)">وی ای پی + (1200 امتیاز)</button></div>
    <div class="shop-item"><img src="https://limogfx.ir/wp-content/uploads/2024/04/%D8%A7%D8%B4%D8%AA%D8%B1%D8%A7%DA%A9-%D9%86%D9%82%D8%B1%D9%87-%D8%A7%DB%8C-1.webp"><button onclick="buyItem('silver', 900)">اشتراک نقره ای (900 امتیاز)</button></div>
    <div class="shop-item"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS7xSj1j4VpAmTuq9LBOFrnJzDJ2P95yN1Cp4cDnNjgjIJ8EFyf87q1EpKnMJ5DBetcgdU&usqp=CAU"><button onclick="buyItem('bronze', 590)">اشتراک برنز (590 امتیاز)</button></div>
    <div class="shop-item"><img src="https://framerusercontent.com/images/JzzTUFwDNuBVlrLsYB6bSWo8RyM.png"><button onclick="buyItem('minecraft', 30000)">خرید سرور ماینکرافت (30000 امتیاز)</button></div>
    <p id="shopMsg"></p>
  </div>
</div>    

<!-- بخش گردونه حرفه‌ای گیمینگ -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('wheelSection')">گردونه</button>
  <div id="wheelSection" class="hidden">
    <div id="wheelWrapper" style="position:relative; width:300px; height:300px; margin:20px auto;">
      <canvas id="wheelCanvas" width="300" height="300" style="border-radius:50%; box-shadow:0 0 20px #7289da;"></canvas>
      <div id="wheelPointer" style="position:absolute; top:-10px; left:50%; transform:translateX(-50%); width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:20px solid #ff0;"></div>
    </div>
    <button id="wheelBtn" onclick="BMProWheel.spin()" style="margin-top:15px; padding:12px 20px; border:none; border-radius:12px; font-size:1rem; cursor:pointer; background: linear-gradient(135deg,#ff00ff,#ff69b4); color:white; box-shadow:0 0 10px #ff69b4; transition:0.3s;">چرخش گردونه</button>
    <p id="wheelMsg" style="margin-top:10px; font-weight:bold; color:#ff0; text-shadow:1px 1px 3px #000;"></p>
    <p id="wheelTimer" style="margin-top:5px; color:#ccc;"></p>
  </div>
</div>

<script>
const BMProWheel = (() => {
  const canvas=document.getElementById("wheelCanvas");
  const ctx=canvas.getContext("2d");
  const radius=canvas.width/2;
  const items=[
    {text:"5 امتیاز", points:5, chance:0.66, color:"#ff0099"},
    {text:"30 امتیاز", points:30, chance:0.3, color:"#ffcc00"},
    {text:"60 امتیاز", points:60, chance:0.2, color:"#00ff99"},
    {text:"پوچ", points:0, chance:0.89, color:"#555555"},
    {text:"150 امتیاز", points:150, chance:0.01, color:"#ff3300"}
  ];

  let spinning=false;
  let points=parseInt(localStorage.getItem("bmpro_points"))||0;
  document.getElementById("points").textContent=points;

  // رسم گردونه
  function drawWheel(rotation=0){
    const total=items.length;
    const sliceAngle=2*Math.PI/total;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<total;i++){
      const startAngle=i*sliceAngle;
      const endAngle=startAngle+sliceAngle;
      ctx.save();
      ctx.translate(radius,radius);
      ctx.rotate(rotation);
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.arc(0,0,radius,startAngle,endAngle);
      ctx.fillStyle=items[i].color;
      ctx.fill();
      ctx.strokeStyle="#222";
      ctx.stroke();
      ctx.rotate(startAngle+sliceAngle/2);
      ctx.textAlign="right";
      ctx.fillStyle="#fff";
      ctx.font="bold 16px Vazirmatn, sans-serif";
      ctx.fillText(items[i].text,radius-10,5);
      ctx.restore();
    }
  }
  drawWheel();

  // تایمر 24 ساعته
  function updateTimer(){
    const lastSpin=localStorage.getItem("bmpro_wheel_last");
    const timerEl=document.getElementById("wheelTimer");
    if(!lastSpin){timerEl.textContent=""; return;}
    const now=Date.now();
    const diff=24*60*60*1000 - (now - lastSpin);
    if(diff<=0){timerEl.textContent="می‌توانید گردونه را بچرخانید"; return;}
    const hours=Math.floor(diff/3600000);
    const mins=Math.floor((diff%3600000)/60000);
    const secs=Math.floor((diff%60000)/1000);
    timerEl.textContent=`زمان تا چرخش بعدی: ${hours}س ${mins}د ${secs}ث`;
    setTimeout(updateTimer,1000);
  }
  updateTimer();

  // انتخاب آیتم بر اساس احتمال
  function selectItem(){
    const r=Math.random();
    let acc=0;
    let chosen=items[0];
    for(let item of items){
      acc+=item.chance;
      if(r<=acc){chosen=item; break;}
    }
    return chosen;
  }

  function spin(){
    if(spinning) return;
    const lastSpin=localStorage.getItem("bmpro_wheel_last");
    const now=Date.now();
    if(lastSpin && now - lastSpin < 24*60*60*1000){alert("فقط یکبار در 24 ساعت می‌توانید بچرخانید"); return;}
    spinning=true;

    const chosen=selectItem();
    const spins=Math.floor(Math.random()*3)+3;
    const sliceAngle=2*Math.PI/items.length;
    const targetAngle=(items.indexOf(chosen)+0.5)*sliceAngle;
    const totalRotation=spins*2*Math.PI + targetAngle;

    const startTime=performance.now();
    const duration=4000;

    function animate(nowTime){
      const t=(nowTime-startTime)/duration;
      const ease=1-Math.pow(1-t,3);
      const angle=ease*totalRotation;
      drawWheel(angle);
      if(t<1){
        requestAnimationFrame(animate);
      } else {
        spinning=false;
        points+=chosen.points;
        document.getElementById("points").textContent=points;
        localStorage.setItem("bmpro_points",points);
        localStorage.setItem("bmpro_wheel_last",Date.now());
        document.getElementById("wheelMsg").textContent=`شما ${chosen.points} امتیاز گرفتید!`;
        updateTimer();
      }
    }
    requestAnimationFrame(animate);
  }

  return {spin};
})();
</script>

  
<!-- سرورها -->
<div class="panel">
  <button class="toggle-btn" onclick="toggleSection('servers')">سرورها</button>
  <div id="servers" class="hidden">
    <button id="srv1" onclick="server1()">سرور 1</button>
    <button id="srv2" onclick="server2()">سرور 2</button>
    <button id="srv3" onclick="server3()">سرور 3</button>
    <button id="srv4" onclick="server4()">سرور 4</button>
    <img id="serverGif" class="server-gif hidden">
    <div id="serverMsg"></div>
    <div id="passwordSection" class="hidden">
      <input type="text" id="serverPassword" placeholder="پسورد را وارد کنید">
      <button onclick="checkPassword()">تایید</button>
      <button onclick="closePassword()">بستن</button>
      <p id="passwordMsg"></p>
    </div>
  </div>
</div>

<script>
const DISCORD_CLIENT_ID = "1413174935593156718";
const REDIRECT_URI = "https://madsmart13.github.io/BM_pro/app.html";

// toggle sections
function toggleSection(id){document.getElementById(id).classList.toggle('hidden');}

// کاربر
const fragment=new URLSearchParams(window.location.hash.slice(1));
const accessToken=fragment.get("access_token");
if(accessToken){fetch("https://discord.com/api/users/@me",{headers:{Authorization:`Bearer ${accessToken}`}})
.then(res=>res.json())
.then(user=>{document.getElementById("username").textContent=user.username+"#"+user.discriminator;document.getElementById("userid").textContent=user.id;localStorage.setItem("discord_user",JSON.stringify(user))});}
else{const savedUser=localStorage.getItem("discord_user");if(savedUser){const user=JSON.parse(savedUser);document.getElementById("username").textContent=user.username+"#"+user.discriminator;document.getElementById("userid").textContent=user.id;}}

// امتیاز
let points=parseInt(localStorage.getItem("bmpro_points"))||0;
document.getElementById("points").textContent=points;
function completeTask(task){if(!localStorage.getItem(`bmpro_task_${task}`)){points+=10;localStorage.setItem("bmpro_points",points);localStorage.setItem(`bmpro_task_${task}`,true);document.getElementById("points").textContent=points;alert("تبریک! ۱۰ امتیاز گرفتید 🎉");}else{alert("این تسک رو قبلاً انجام دادید!");}}

// دیسکورد
function joinDiscordChannel(){window.open("https://discord.com/invite/kkdDtDcG","_blank");completeTask('join');}

// شماره موبایل
function showMobileInput(){document.getElementById("mobileInput").classList.remove("hidden");}
function submitMobile(){const mobile=document.getElementById("mobile").value.trim();const msg=document.getElementById("mobileMsg");if(!/^09\d{9}$/.test(mobile)){msg.textContent="شماره نامعتبر است!";return;}msg.textContent="در انتظار تایید ادمین";if(!localStorage.getItem('bmpro_task_mobile')){points+=10;localStorage.setItem("bmpro_points",points);localStorage.setItem('bmpro_task_mobile',true);document.getElementById("points").textContent=points;}}

// فروشگاه
function buyItem(id,cost){const msg=document.getElementById("shopMsg");if(points<cost){msg.textContent="امتیاز کافی نیست!";return;}points-=cost;localStorage.setItem("bmpro_points",points);document.getElementById("points").textContent=points;msg.textContent="در سرور دیسکورد ما در بخش خرید پیام بگذارید";}

// سرورها و GIF
let currentGif=null;
function clearGif(){const gif=document.getElementById("serverGif");gif.classList.add("hidden");gif.src="";}
function server1(){clearGif();document.getElementById("serverMsg").textContent="ورود دستی! ای پی سرور: wii1-rFFa.aternos.me:22481";}
function server2(){clearGif();const gif=document.getElementById("serverGif");gif.src="https://cdn3d.iconscout.com/3d/premium/thumb/cloud-server-disconnected-3d-icon-png-download-4504975.png";gif.classList.remove("hidden");document.getElementById("serverMsg").textContent="سرور افلاین است";}
function server3(){clearGif();document.getElementById("serverMsg").textContent="در حال اتصال...";setTimeout(()=>{const gif=document.getElementById("serverGif");gif.src="https://cdn3d.iconscout.com/3d/premium/thumb/cloud-server-disconnected-3d-icon-png-download-4504975.png";gif.classList.remove("hidden");document.getElementById("serverMsg").textContent="ورود خودکار ممکن نیست";},4000);}
function server4(){clearGif();document.getElementById("serverMsg").textContent="در حال اتصال...";setTimeout(()=>{document.getElementById("serverMsg").textContent="";document.getElementById("passwordSection").classList.remove("hidden");},4000);}
function checkPassword(){const pass=document.getElementById("serverPassword").value;const msg=document.getElementById("passwordMsg");if(pass==="ijff[hihfhofh"){msg.textContent="wii1-rFFa.aternos.me:22481";}else{msg.textContent="پسورد اشتباه است";}}
function closePassword(){document.getElementById("passwordSection").classList.add("hidden");}
</script>
</body>
</html>
